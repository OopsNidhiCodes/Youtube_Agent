services:
  - type: worker
    name: youtube-tech-agent-free
    env: python
    buildCommand: |
      echo "Installing Python dependencies (CPU-only)..."
      pip install -r requirements_free.txt
      pip install --index-url https://download.pytorch.org/whl/cpu torch torchvision torchaudio
      echo "Creating directories..."
      mkdir -p output temp logs videos
      echo "Build completed!"
    startCommand: python main_free.py --mode automated
    envVars:
      # Video settings (free)
      - key: VIDEO_UPLOAD_TIME
        value: "09:00"
      - key: VIDEO_TOPIC
        value: "technology"
      - key: VIDEO_LENGTH
        value: "60"
      - key: UPLOAD_SCHEDULE
        value: "daily"
      - key: LOG_LEVEL
        value: "INFO"
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PYTHON_VERSION
        value: "3.11.6"
      
      # Free AI settings
      - key: AI_MODEL_NAME
        value: "microsoft/DialoGPT-medium"
      - key: AI_DEVICE
        value: "cpu"
      - key: AI_MAX_LENGTH
        value: "500"
      - key: AI_TEMPERATURE
        value: "0.7"
      
      # Delivery settings for no-disk deployment
      - key: OUTPUT_DELIVERY
        value: "transfer_sh"
      
      # Cleanup settings
      - key: KEEP_VIDEO_COUNT
        value: "5"
      - key: CLEANUP_OLD_FILES
        value: "true"
      
      # Render free tier flag
      - key: RENDER_FREE_TIER
        value: "true"
    
    # No disk on free tier; files delivered via transfer.sh
    
    # Free tier settings
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    
    # Resource limits for free tier
    memory: 512Mi
    cpu: 100m
    
    # Environment notes
    envGroups: []
    
    # Scaling (disabled for free tier)
    scaling:
      minInstances: 0
      maxInstances: 1
      targetCPUPercent: 70
      targetMemoryPercent: 80